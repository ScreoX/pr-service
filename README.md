# Pull Request Service

## Допущения из OpenAPI и ТЗ

### OpenAPI

#### Возвращаемые ошибки
1. Были добавлены дополнительные ошибки, так как **OpenAPI** не имела всего множество ошибок, которое бы покрывало все сценарии. С ошибками можно ознакомиться в `pr-service\internal\api\apierrors`. Также были добавлены валидационные ошибки.
2. При создании команды, которая уже существует в **OpenAPI** была указана ошибка: `400` (Bad Request). Она была заменена на `409` (Conflict).

#### Логика запросов
1. Создание/обновление команды для удовлетворения возвращаемым ошибкам сделано следующим образом. Если команда не была создана, то она создается. Повтороное создание команды с таким же идентификатором приведет к ошибке `409` (Conflict). В случае надобности изменения команды следует изменить идентификатор. Члены команды, указанные в новой команде, перейдут в нее. Те члены команды, которые не были указаны, останутся в прежней.
2. При создании `pull request'а` в ответе пишется дополнительно `created_at`.

### ТЗ

#### Логика
1. В ТЗ написано, что пользователь с флагом `isActive = false` не может назначаться на ревью, но не сказано, может ли он быть создателем `pull request'a`. Логика была построена следующим образом: пользователь с флагом `isActive = false` не сможет создать `pull request` и быть в нем ревьюером. Если пользователь ставновится ревьером, а потом ему устанавливается флаг `isActive = false`, то пользователь должен выполнить тех долг. При его замене (если будут доступные другие участники команды) он исчезнет из ревьюеров и больше туда попасть не сможет до тех пор, пока он не будет активен: `isActive = true`. 

## Допонительный Endpoint

| Метод | Endpoint | Описание |
|-------|----------|-----------|
| `GET` | `/stats` | Статистика по пользователям, командам и pr'ам |

## Makefile
В проекте создан **Makefile**

| Команда                 | Описание                                   |
|-------------------------|--------------------------------------------|
| `make lint-install`     | Установка линтеров                         |
| `make lint`             | Проверка кода линтером                     |
| `make build`            | Сборка Docker образов                      |
| `make up`               | Запуск контейнеров                         |
| `make down`             | Остановка сервиса                          |
| `make down-clean`       | Остановка с удалением volumes              |
| `make start`            | Запуск контейнеров с выводом порта      |
| `make start-with-build` | Полный запуск сервиса (build + up) |
| `make test`             | Запуск всех тестов                         |
| `make test-unit`        | Запуск unit тестов                         |
| `make test-integration` | Запуск интеграционных тестов               |
| `make test-down`        | Очистка тестовых контейнеров               |

## Запуск проекта

### Клонирование репозитория

``` bash
git clone https://github.com/ScreoX/pr-service.git
cd pr-service
```

### Конфигурация

После клонирования в корне проекта будут находиться файлы конфигурации: `.env.example` и `.env.test.example`. Достаточно просто убрать из названий `.example`. После этого можно будет запускать проект.

### Запуск

``` bash
docker-compose up
```

Также можно воспользоваться командами из **Makefile**

## Тестирование

В проекте тестирование запускается через следующие команды. 

Запуск unit-тестов
``` bash
make test-unit
```

Запуск интеграционных тестов
Для них запускается тестовая БД и приложение
``` bash
make test-integration
```

Запуск всех тестов
``` bash
make test
```

## Линтер

В проекте используется `golangci-lint` для статического анализа кода. Конфигурация находится в файле `.golinter.yml`. 

### Установка и запуск

``` bash
make lint-install
make lint
```

### Включенные линтеры

- **errcheck** - проверка необработанных ошибок
- **gosimple** - проверка на простоту кода
- **govet** - стандартный анализатор GoLang'а
- **ineffassign** - обнаружение неэффективных присваиваний
- **staticcheck** - статический анализ
- **typecheck** - проверка типов
- **unused** - обнаружение неиспользуемого кода
- **gofmt** - проверка форматирования
- **goimports** - проверка импортов
- **misspell** - проверка орфографии
- **predeclared** - обнаружение переопределения встроенных идентификаторов
